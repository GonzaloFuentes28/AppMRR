---
/**
 * Home Page (AppMRR Leaderboard)
 * 
 * Main landing page displaying the leaderboard of apps ranked by MRR and revenue.
 * This page orchestrates all the components and handles data fetching.
 * 
 * Features:
 * - Server-side rendering with fresh data (no caching)
 * - Sortable columns (MRR, Revenue)
 * - Add app modal
 * - FAQ section
 * - Light/dark theme toggle
 */
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import AddAppButton from '../components/AddAppButton.astro';
import EmptyState from '../components/EmptyState.astro';
import LeaderboardTable from '../components/LeaderboardTable.astro';
import AddAppModal from '../components/AddAppModal.astro';
import FAQSection from '../components/FAQSection.astro';
import { getStartupsWithMetrics } from '../lib/db';

// Disable caching to ensure we always get the latest data
export const prerender = false;

// Get sort parameter from query string, default to 'revenue'
const sortBy = (Astro.url.searchParams.get('sort') as 'revenue' | 'mrr') || 'revenue';
const sortOrder = (Astro.url.searchParams.get('order') as 'asc' | 'desc') || 'desc';
const startups = await getStartupsWithMetrics(sortBy);
---

<Layout title="AppMRR Leaderboard">
        <main class="page-shell">
                <div class="page-container">
                        <Header />

                        <AddAppButton />

                        {startups.length === 0 ? (
                                <EmptyState />
                        ) : (
                                <LeaderboardTable startups={startups} />
                        )}

                        <FAQSection />
                </div>
        </main>

	<AddAppModal />
</Layout>

<script>
	// Import all client-side scripts
	import '../scripts/theme';
	import '../scripts/modal';
	import '../scripts/form';
	import '../scripts/table';
	import '../scripts/images';
</script>

<style>
        .page-shell {
                min-height: calc(100vh - 200px);
                padding: clamp(2.5rem, 6vw, 4.5rem) 1.5rem 3rem;
                display: flex;
                justify-content: center;
                transition: padding 0.3s ease;
        }

        .page-container {
                width: min(1080px, 100%);
                display: flex;
                flex-direction: column;
                gap: 2rem;
        }

        @media (max-width: 768px) {
                .page-shell {
                        padding: 2rem 1.25rem 2.5rem;
                }

                .page-container {
                        gap: 1.75rem;
                }
        }
</style>
